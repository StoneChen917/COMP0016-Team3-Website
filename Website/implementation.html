<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementation</title>

    <link rel="stylesheet" href="assets/css/Global.css">
    <link rel="stylesheet" href="assets/css/Header.css">
    <link rel="stylesheet" href="assets/css/Footer.css">

    <link rel="stylesheet" href="assets/css/pages/implement.css">

    <style>
        /* .image-bundle {
            display: grid;
            align-items: center; 
            grid-template-columns: 1fr 1fr 1fr;
            column-gap: 5px;
        }
        
        .img {
            max-width: 50%;
            max-height: 50%;
        } */

        .image-bundle {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        .image-bundle img {
            width: 20%;
        }

        @media (max-width: 768px) {
            .image-bundle img {
                width: 50%;
            }
        }
        
        /* .text {
            font-size: 70px;
        } */
    
        /* .mycode{
        display: block; 
        padding: 3px 3px 2px; 
        font-size: 14px; 
        line-height: 20px;
        width: 100%;
        background-color: #333;
        font-family: arial;
        color: #f7f7f7;
        font-weight: bold;
    } */
    </style>
</head>



<body>
    <header>
        <!-- ***** Logo Start ***** -->
        <!-- <a href="index.html" class="logo">
            <img src="assets/images/go-logo-2020.png" alt="IFRC-GO">
        </a> -->
        <!-- ***** Logo End ***** -->
        <!-- ***** Menu Start ***** -->
        <!-- <ul class="menu" id="menu">
            <li class="submenu">
                <a class="mainlink" href="index.html">Home</a>
            </li>
            <li class="submenu">
                <a class="mainlink" href="requirements.html">Requirements</a>
            </li>

            <li class="submenu" class="submenu">
                <a class="mainlink" href="research.html">Research</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="algorithms.html">Algorithms</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="design.html">Design</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="implementation.html">Implementation</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="testing.html">Testing</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="evaluation.html">Evaluation</a>
            </li>
            <li class="submenu" class="submenu">
                <a class="mainlink" href="appendix.html">Appendix</a>
            </li>
        </ul>
        <a class='menu-mobile'>
            <span>Menu</span>
        </a> -->
        <!-- ***** Menu Start ***** -->
    </header>

    <div class="navbar">
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'index.html';">Home 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="index.html#abstracts">Abstracts</a>
            <a href="index.html#features">Features</a>
            <a href="index.html#team-members">Team Members</a>
            <a href="index.html#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'requirements.html';">Requirements 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="requirements.html#pb">Project Background</a>
            <a href="requirements.html#pg">Project Goals</a>
            <a href="requirements.html#gor">Gathering of Requirements</a>
            <a href="requirements.html#personas">Personas</a>
            <a href="requirements.html#moscow">MoSCoW Requirements</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'research.html';">Research 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'design.html';">Design 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'implementation.html';">Implementation 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'testing.html';">Testing 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'evaluation.html';">Evaluation 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href = 'appendix.html';">Appendix 
            <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
            <a href="#abstracts">Abstracts</a>
            <a href="#features">Features</a>
            <a href="#team-members">Team Members</a>
            <a href="#gantt-chart">Gantt Chart</a>
            </div>
        </div> 
    </div>
<!--MAIN CONTENT STARTS HERE-->

    <section class="section" id="Overview">
        <div style="text-align: center;"><h3>Implementation</h3></div>
        <hr class="solid">

        <h4>Impl. Overview(insert pic of new integ)</h4>
        <div class="image-bundle">
<!--            <img src="assets/images/implementation/technology/react.png">-->
            <div>
                <p>1.) Retrieve file(s) from drag and drop in UI</p>
                <p>2.) Read first page of document</p>
                <p>3.) Run QA model on first page to extract answers</p>
                <p>4.) Get ISO code of country extracted by QA model using fuzzy matching</p>
                <p>5.) Run spaCy to extract locations</p>
                <p>6.) Remove duplicate locations found/p>
                <p>7.) Get P-codes of locations found using fuzzy matching</p>
                <p>8.) Combine all extracted data and display on UI</p>
                <p>9.) Save answers to database?</p>



                <p><span style="color: #ee2a24">* note that all files mentioned can be found in src/Backend/Integration </span></p>
            </div>
        </div>
    </section>

    <section class="section" id="read">
        <h4>Retrieving and reading file(s)</h4>
        <div class="image-bundle">
            <!-- <img src="assets/images/implementation/technology/flask.png"> -->
            <div>
                <p>
                    As shown in the UI design page, users are able to upload a file, or multiple files. We use python's built in library 'PyPDF2' to extract the text content of the PDFs. 
                    This is done using the <span style="color: #0000a0">read_file()</span> method <span style="color: #ee2a24">'readfile.py'</span> file.
                    <pre class="mycode"> 
                        <code>
                            def read_file(self, file):
                                f = open(file, 'rb')
                                pdfReader = PdfReader(f)
                                pageone = PyPDF2.PdfReader(f).pages[0].extract_text()
                                text = ""
                                for i in range(1, len(pdfReader.pages)):
                                    text += PyPDF2.PdfReader(f).pages[i].extract_text()
                                f.close()
                                return pageone, text 
                        </code>
                    </pre> 
                </p>
            </div>
        </div>
    </section>

    <section class="section" id="answer">
        <h4>Answer exctraction</h4>
        <div class="image-bundle">
            <div>
                <p>
                    Then we run the QA model on it to extract the answers shown below. The questions are stored as a list in the class attributes, and all the answers are stored as a dictionary in the class attribute <span style="color: #0000a0">self.answers </span> 
                    <pre class="mycode"> 
                        <code>
                            def __init__(self, file):
                                self.file = file
                                self.questions=["What is the Country of Disaster?",
                                "What is the Operation Start Date?", 
                                "What is the Operation End Date?",
                                "What is the number of people affected?", 
                                "What is the number of people assisted?", 
                                "What is the Glide Number?", 
                                "What is the Operation n°?", 
                                "What is the Operation Budget?", 
                                "What is the Host National Society?"]
                                self.answers = {}
                                self.extract_ans()
                        </code>
                    </pre> 

                    The method that does the main extraction is the <span style="color: #ee2a24">extract_ans()</span> method shown below. It loops through the questions and stores it in <span style="color: #0000a0">self.answers </span> dictionary, with the question as the key and the answer as the value.
                    

                    <pre class="mycode"> 
                        <code>
                            def extract_ans(self):
                                # get first page of document
                                reader = ReadFile()
                                first_page = reader.exec(self.file)[0]
                                context = first_page
                        
                                # loop through questions
                                for n in self.questions:
                                    tokenizer.encode(n, truncation = True, padding = True)
                                    tokenizer.encode('[CLS]')
                                    nlp = pipeline('question-answering', model = model, tokenizer = tokenizer)
                                    answer = nlp({'question': n, 'context': context})['answer']
                                    self.answers[n] = str(answer)
                        </code>
                    </pre> 
                </p>
            </div>
        </div>
    </section>

    <section class="section" id="loc">
        <h4>Location extraction</h4>
        <div class="image-bundle">
            <div>
                <p>
                    For extracting locations, we used the spaCy library. As seen in the <span style="color: #ee2a24">exctract_loc()</span> function below, first we load the spaCy model, stored in the 'nlp' variable. Then we make a container for the nlp library called 'doc', which takes in the text of the DREF document. This container contains all the annotations, labels and entities of the text. 
                    <pre class="mycode"> 
                        <code>
                            def __init__(self, file):
                                self.file = file
                                self.locations = self.exctract_loc()
                        </code>
                    </pre> 

                    <pre class="mycode"> 
                        <code>
                            def exctract_loc(self):   
                                nlp = spacy.load("en_core_web_lg")
                                .
                                . 
                                . 
                                doc = nlp(first_page)

                                locations = []
                                for ent in doc.ents:
                                    if ent.label_ == "GPE":
                                        locations.append(ent.text)

                                # Remove duplicate locations
                                clean = []
                                for i in locations:
                                    if i not in clean:
                                        clean.append(i)
                                return clean
                        </code>
                    </pre> 
                    The function gets all the entities labelled "GPE", standing for Geopolitical Entity, and places it in a temporary list 'locations'. We then make another list 'clean' which is thethe list of locations with exact match duplicates removed. This adjusted list is then saved to the<span style="color: #0000a0">self.locations</span> class attribute. 
                </p>
            </div>
        </div>
    </section>

    <section class="section" id="code">
        <h4>Code Matching</h4>
        <div class="image-bundle">
            <img src="assets/images/implementation/technology/flask.png">
            <div>
                <p>
                    We decided to use Fuzzy matching to compare extracted locations to the excel spreadsheet of Admins 0, 1 & 2 locations, thus finding the corresponding codes. We used the python library 'Pandas' to read from the excel sheets. This is done in the file called <span style="color: #ee2a24">exctract_loc()</span> 

                    Process for finding ISO codes:
                    1.) Filter excel sheet by first letter of Country extrcated by QA model
                    2.) Try to find exact match 
                    3.) If no exact match found, find the best match by comparing 'fuzz ratio', Which is the similarity score of our country, to the country names in the filtered excel sheet. The higher the score the more similar the words are. 
                    <pre class="mycode"> 
                        <code>
                            
                        </code>
                    </pre> 
                </p>
            </div>
        </div>
    </section>

    <section class="section" id="display">
        <h4>Display and save</h4>
        <div class="image-bundle">
            <img src="assets/images/implementation/technology/flask.png">
            <div>
                <p>
                    <pre class="mycode"> 
                        <code>
                            def __init__(self, admin_0, loc_list):
                                self.admin_0 = admin_0
                                # list of dict of pcodes for admin 1 & locations
                                self.loc_list = loc_list
                                self.ISO_code = self.getISOCode()
                                self.p_code_1 = []
                                self.p_code_2 = []
                        </code>
                    </pre> 
                    

                    <pre class="mycode"> 
                        <code>
                            def loop_p_codes(self):
                                for loc in self.loc_list:
                                    tag = self.find_p_code(loc)[0]
                                    p_code = self.find_p_code(loc)[1]
                                    dict = {"Location":loc, "P-Code":p_code}
                                    if tag == 1:
                                        self.p_code_1.append(dict)
                                    if tag == 2:
                                        self.p_code_2.append(dict)
                        </code>
                    </pre> 
                </p>
            </div>
        </div>
    </section>

    <!-- TECHNOLOGIES -->
    <section class="section" id="front-end">
        <!-- topic -->
        <h3>Technology</h3>
        <!-- contents -->
        <h4>Frontend</h4>
        <div class="image-bundle">
            <img src="assets/images/Implementation/logos/tkinter-tutorial.png">
            <div>
                <h5>Framework: Tkinter</h5>
                <p>Library: react-cookie (for using cookie),react-redux (for using redux), react-icons, react-router-dom (managing route),runtime-env-cra(inject runtime environment on production environment), framer-motion(make animation)</p>
            </div>
        </div>

        <h4>Backend</h4>
        <div class="image-bundle">
            <img src="assets/images/Implementation/logos/qa.png" >
            <div>
                <h5>Framework: Hugging Face</h5>
                <p>Model name: Roberta, name: "deepset/roberta-base-squad2"</p>
            </div> 
        </div>

        <div class="image-bundle">
            <img src="assets/images/Implementation/logos/spacy.png">
            <div>
                <h5>Framework: spaCy</h5>
                <p>Model: "en_core_web_lg"
                </p>
            </div>
        </div>

        <h4>Deployment</h4>
        <div class="image-bundle">
            <img src="assets/images/Implementation/logos/pg.png">
            <div>
                <h5>Postgres</h5>
                <p>For deploying database</p>
            </div>
        </div>

    </section>


    <footer class="footer-content">
        <div class="row">
            <div class="right-content">
                <h2>About Us</h2>
                <p>
                    We're an ambitious student team from UCL Computer Science.
                </p>
                <ul class="social">
                    <li><a href="#"><i class="fa fa-github"></i></a></li>
                </ul>
            </div>
            <div class="left-content">
                <h2>Site Menu</h2>
                <div class="container">
                    <div class="nav-list">
                        <div class="col-3"><a href="index.html">Home</a></div>
                        <div class="col-3"><a href="requirements.html">Requirement</a></div>
                        <div class="col-3"><a href="research.html">Research</a></div>
                        <div class="col-3"><a href="design.html">Design</a></div>
                        <div class="col-3"><a href="implementation.html">Implementation</a></div>
                        <div class="col-3"><a href="testing.html">Testing</a></div>
                        <div class="col-3"><a href="evaluation.html">Evaluation</a></div>
                        <div class="col-3"><a href="appendix.html">Appendix</a></div>
                    </div>
                </div>

            </div>
        </div>
        <div class="sub-footer">
            <p>Copyright &copy; 2022 CIFRC</p>
        </div>
    </footer>
</body>